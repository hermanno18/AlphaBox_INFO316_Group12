{% extends "alphabox/base.html" %}
{% load static %}
{% block title %}{% endblock title %}

{% block stylesheet %}
    {{block.super}}
    <link href="{% static 'alphabox/assets/css/gameMainStyle.css' %}" rel="stylesheet">
    <style>

      @font-face {
        font-family: myFirstFont;
        src: url({% static 'alphabox/assets/fonts/fanta___.ttf' %});
      }
      /* pour le clavier virtuel */
      .virtualKeyBoardDisplay .letter{
        font-family: fantasyFont;
        font-size: 18px;
        
      }
      .multiselect {
        text-align: left;
        width: 300px;
      }
      .multiselect b.caret {
        position: absolute;
        top: 14px;
        right: 8px;
      }
      ul.multiselect-container{
        padding: 15px;
      }
      .multiselect-group {
        font-weight: bold;
      }
      .multiselect-all label {
        font-weight: bold;
      }
      .multiselect-search {
        color: red;
      }
    </style>
{% endblock stylesheet %}

    {% block backgroundAnimations %}
        <div class="bg"></div>
        <div class="bg bg2"></div>
        <div class="bg bg3"></div>
    {% endblock backgroundAnimations %}

{% block content %}
        <div class="">
          <div class="masthead-brand d-flex text-white justify-content-between align-items-center m-0 mx-3">
            <h2 class="masthead-brand d-flex text-white justify-content-between align-items-center m-0 mx-3"><i class="fas fa-2x fa-gamepad animated headShake slow infinite"></i> <span>AlphaBox</span></h2>
            <div class="inner">
              <a href="javascript:void(0)" class="mx-2 btn btn-outline-white p-1" onclick="openNav()"> <i class="fa fa-1x fa-clipboard-list"></i> Menu</a>
            </div>
          </div>        
        </div>
        {% block gameUtils %}
          
        {% endblock gameUtils %}
        {% block gameCanvas %}
 
          {% endblock gameCanvas %}
        <!-- Modal pour les réglages du jeu-->
        <div class="modal fade text-dark"   id="configGameModal" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered dialog-scrollable">
            <div class="modal-content">
              <div class="modal-body">
                <form class="form-signin " id='settingForm'>
                  {% csrf_token %}
                  <div class="d-flex text-white justify-content-between align-items-center mb-2 text-dark">
                      <i class="fas fa-cog fa-spin fa-6x"></i>
                    <div style="width: 75%;">
                      <h2 class="h3 mb-1 font-weight-normal text-info">Avant de commencer, faites quelques petits réglages</h2> <hr>
                    </div>
                  </div>  
                  <div class="mb-4">
                    <small >Utilisez la configuration par défaut en Cliquant sur <span class="badge badge-lg badge-success">commencer</span> sans modifier les champs</small> 
                  </div>   

                  <div class="row mb-3">
                    <div class="form-label col-sm-6">
                      <label for="gameTimer" class="mx-3">Durée du décompte ( <small>Temps pour saisir vos mots</small> )</label>
                      <input type="range"  id="gameTimer" name="gameTimer" min="10" max="120"  class="form-control" placeholder="Date de début" required>
                    </div>
                    <div class="form-label col-sm-6">
                      <label for="gameLang" class="mx-3">Quelle langue voulez vous utiliser pour cette partie?</label>
                      <input type="text" id="gameLang" name="gameLang" class="form-control" placeholder="Quelle langue voulez vous utiliser pour cette partie?" required>
                    </div>
                  </div>
                  <div class="input-group btn-group mb-2 col-sm-12">
                      <span class="input-group-addon"><i class="fas fa-times-circle"></i></span>
                      <select  id="gameOthersMembers" name="gameOthersMembers" data-role="multiselect" multiple="multiple">
                      <option value="lab">joueur 1</option>
                      <option value="proseminar">joueur 9</option>
                      <option value="proseminar">joueur 2</option>
                      <option value="proseminar">joueur 5</option>
                      <optgroup label="Autres">
                      <option value="analysis">joueur</option>
                      <option value="algebra">joueur Algebra</option>
                      <option value="discrete">joueur Mathematics</option>
                      <option value="numerical">joueur Analysis</option>
                      <option value="probability">joueur Theory</option>
                      </optgroup>
                    </select>
                  </div>


                  <div class="btn-group btn-lg d-flex ">
                    <button onclick="setGameParameters()" class="btn btn-success" class="close" data-dismiss="modal" aria-label="Close"> <i class="fas fa-check-circle"></i> Commencer</button>
                    <a href="{% url 'alphabox:home' %}" class="btn btn-danger "> <i class="fas fa-times-circle"></i> Annuler</a>
                  </div>
                </form>          
              </div>
            </div>
          </div>
        </div>

        <!-- Modal pour le compte à rebour avant le lancement-->
        <div class="modal fade text-dark"   id="countdownModal" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="registerModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered dialog-scrollable ">
            <div class="modal-content">
              <div class="modal-body">
                  <span id='countdownValue' class="">
                  </span>
              </div>
            </div>
          </div>
        </div>

        <p id="repose">

        </p>
        <div class="col-12 bg-light" id="virtualKeyBoard">
          <div class="virtualKeyBoardDisplay row d-flex justify-content-between">
            <span class="letter btn btn-dark" onclick="setGameLetter('a')">a</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('b')">b</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('c')">c</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('d')">d</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('e')">e</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('f')">f</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('g')">g</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('h')">h</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('i')">i</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('j')">j</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('k')">k</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('l')">l</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('m')">m</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('n')">n</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('o')">o</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('p')">p</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('q')">q</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('r')">r</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('s')">s</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('t')">t</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('u')">u</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('v')">v</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('w')">w</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('x')">x</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('y')">y</span>
            <span class="letter btn btn-dark" onclick="setGameLetter('z')">z</span>
          </div>
        </div>
{% endblock content %}
{% block script %}
    {{block.super}}
    <script src="{% static 'alphabox/assets/js/multipleSelect.js' %}"></script>
    <script>
      $('#gameOthersMembers').multiselect({
          //  includeSelectAllOption: true,
            enableCaseInsensitiveFiltering: true,
            filterPlaceholder: 'entrez le nom du joueur que vous recherchez...',
            buttonClass: 'btn btn-sm btn-outline-secondary w-100',
            enableCollapsibleOptGroups: true,
            buttonWidth: '150px',
            dropRight: true
        });
    </script>

    <script type="text/javascript">
        //pour afficher le modal de réglage au chargement de la page
        $(window).on('load', function() {
            $('#configGameModal').modal('show');
          });
        


        // définition de ma structure de donnée pour gerer les paramettres (elle sera envoyée via AJAx pour etre sauvée
        GAME_SETTING = {
          author: "Hermanno", // pas trop nécéssaire
          created_at:  new Date().getTime(),
          gameModule: "guessWords", // à changet avec Django
          letter : null,
          timer: null ,
          lang : null,
          turn : 0,
          id: null
        }
        GAME_SETTING.id = GAME_SETTING.created_at+"_"+GAME_SETTING.author+"_"+GAME_SETTING.gameModule


        // la fonction qui défini les paramettres du jeu
        function setGameParameters(){

//          a - on insere donc ces infos dans l'objet GAME_SETTING........ o
          GAME_SETTING.lang = document.getElementById('gameLang').value
          GAME_SETTING.timer = document.getElementById('gameTimer').value
          //GAME_SETTING.lang =  document.getElementById('gameOthersMembers').value

//          b - on charge l'animation pour sélectionner une lettre
          $('#countdownModal').modal('show');
          $('#countdownValue').html($('#virtualKeyBoard').html());
          }











          //scripts qui peuvent etre déplacés dans un fichier JS externe
          function setGameLetter(letter){
//            a - on insere donc ces infos dans l'objet GAME_SETTING          
            GAME_SETTING.letter = letter
              $('#countdownValue').html("<div class='d-flex justify-content-center' ><i class='fas fa-cog fa-spin fa-6x'></i></div>")
            
//            on incrémente l'attibut tours 
            GAME_SETTING.turn ++

//            c - on envois une requette Ajax pour sauver ses réglages
            //début AJAX

            $.ajax({
                data: GAME_SETTING , // on récupere les données du formulaire
                type: 'GET', // on précise la methode
                url: "{% url 'alphabox:game_guessWords_settings' %}", //l'url vers laquelle AJAX doit diriger la requette
                // on success 
                success: function(response) { // si tout se passe bien NOTE: reponse contient la réponse obtenu de la requette
                  // alors on fait des choeses ici
                    document.getElementById("repose").innerHTML= "vous apprenez "+response.lang
                    console.log("my object: %o", response) // ca c'est la commande pour dumper un objet en console
                },
                // on error
                error: function(response) { //sinon
                  //on réagi ici
                    console.log("the error returned: %o", response)
                }
            });
            //fin AJAX

//          puis je démarre le compte à rebour 
            // Set the date we're counting down to
            var countDownDate = new Date().getTime()+8000;
            // Update the count down every 1 second
            var x = setInterval(function() {

              // Get today's date and time
              var now = new Date().getTime();

              // Find the distance between now and the count down date
              var distance = countDownDate - now;

              // Time calculations for days, hours, minutes and seconds
              var days = Math.floor(distance / (1000 * 60 * 60 * 24));
              var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
              var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
              var seconds = Math.floor((distance % (1000 * 60)) / 1000);

              // Display the result in the element with id="demo"
              
              HTML = days + "d " + hours + "h "
              + minutes + "m " + seconds + "s ";
              $('#countdownValue').html(HTML)
              // If the count down is finished, write some text
              if (distance < 1) {
                clearInterval(x);
                $('#countdownModal').modal('toggle');
                //on appelle le jeu proprement dit                    
                game()
            }
            }, 1000);
            
          }
    </script>
    <script>
      //notes : 
      /*
        Ordre d'éxécussion
        1 - on définit les réglages (temps, langue, autres joeurs)
            a - on insere donc ces infos dans l'objet GAME_SETTING........ ok
            b - on charge l'animation pour sélectionner une lettre.........ok
        2 - on sélectionne une lettre 
            a - on insere donc ces infos dans l'objet GAME_SETTING.........ok
            b - on incrémente l'attibut tours .............................ok
            c - on envois une requette Ajax pour sauver ses réglages.......
            d - on lance le compte à rebourd pour lancer le jeu............ok
        3 - on démarre le timer et joue
            a - l'utilisateur entre un mot.................................ok
            b - on s'assure que le mot commence par la lettre qu'il a pr"cedement enttrée
            b - on envois une requette Ajax pour vérifier la validité du mot 
                on retourne un bolleen et on écrit dans un fichier Json tous les détails du mot (définition, image, synonymes, antonymes...) 
            c - on ajoute le mot saisit avec le style correspondant (si c'est correct 'success' sinon 'danger') dans la liste 'ul' corresponante
                on incrémente le nombre de mots trouvés (dans l'afichage et dans l'objet)
        4 - quand le ttimer s'arrette
            a - on cache le champ de saisie
            b - on  (JS) lit dans le fichier Json (écrit par pyton) pour afficher les mots que l'utiliasteur a saisit
                et on affiche ces mots dans un modal de telle sorte que s'il clique dessu il a leur définittion et tout le tralala
            c - dans le meme modal, on affiche 5 mots que l'utilisateur n'a pas donné de telle sorte que s'il clique dessu il a leur définittion et tout le tralala
            d - on sauvegarde sa partie (ses points, ...), et la liste de mots appris
        5 - il peut cliquer sur continuer ou quitter
            a - s'il clique sur quitter on le redireige à la homePage
            b - s'il clique sur continuer on recommence le processus à partir de 2 (on lui demande de choisir une lettre etc)
      */
    </script>
{% endblock script %}